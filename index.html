<!--
Files included in this single document:

1) index.html  -> Frontend (single-file HTML + JS/CSS). Opens a title screen, Play, then gameplay that sends prompts to your backend for ChatGPT responses. Includes save/load UI for player name (first + last) and save slots stored in localStorage.

2) server.js   -> Minimal Node/Express proxy endpoint that forwards requests to the OpenAI Chat Completions API using the server-side OPENAI_API_KEY (keep your key secret). This prevents exposing your key in the browser.

3) README (at bottom) -> How to install and run locally.

-->

<!-- ======================= index.html ======================= -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ChronoNotes — a tiny time travel game</title>
  <style>
    :root{--bg:#0b1020;--card:#0f1724;--accent:#7dd3fc;--muted:#94a3b8;}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:grid;place-items:center;background:linear-gradient(180deg,#020617 0%, #07112a 100%);color:#e6eef8}
    .screen{width:960px;max-width:96%;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.03));border-radius:16px;box-shadow:0 10px 40px rgba(2,6,23,0.6);padding:28px}
    h1{margin:0 0 6px;font-size:28px}
    .muted{color:var(--muted);font-size:13px}

    .title-center{display:flex;align-items:center;gap:18px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;color:inherit;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#042; border:none}

    .game-area{margin-top:18px;display:grid;grid-template-columns:2fr 1fr;gap:18px}
    .log{background:rgba(255,255,255,0.02);padding:14px;border-radius:12px;height:420px;overflow:auto}
    .sidebar{background:rgba(255,255,255,0.02);padding:14px;border-radius:12px;height:420px;display:flex;flex-direction:column;gap:12px}

    .row{display:flex;gap:8px;align-items:center}
    input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    .save-slot{display:flex;gap:8px;align-items:center}
    .slot{padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03);min-width:0;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:grid;place-items:center}
    .modal{background:var(--card);padding:18px;border-radius:12px;min-width:320px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    small{color:var(--muted)}

    footer{margin-top:12px;color:var(--muted);font-size:13px}

  </style>
</head>
<body>
  <div class="screen" id="screen">
    <div id="titleScreen">
      <div class="title-center">
        <div>
          <h1>ChronoNotes</h1>
          <div class="muted">A tiny HTML time-travel adventure that uses ChatGPT responses.</div>
        </div>
        <div style="margin-left:auto">
          <button id="btn-play" class="btn-primary">Play</button>
        </div>
      </div>
      <p style="margin-top:14px">Press Play to begin. The game will ask a few questions and then consult the AI to narrate timey-wimey events.</p>
    </div>

    <div id="gameScreen" style="display:none">
      <div class="row" style="justify-content:space-between;align-items:flex-end">
        <div>
          <strong id="playerName">Traveler</strong>
          <div class="muted">ChronoInstability: <span id="instability">0</span></div>
        </div>
        <div class="row">
          <button id="btn-save">Save</button>
          <button id="btn-load">Load</button>
          <button id="btn-quit">Quit</button>
        </div>
      </div>

      <div class="game-area">
        <div>
          <div class="log" id="log"></div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <input id="playerInput" type="text" placeholder="Type an action or question..." />
            <button id="btn-send">Send</button>
          </div>
        </div>

        <div class="sidebar">
          <div>
            <label>Timeline</label>
            <select id="timeline"></select>
            <small>Choose the era to visit — AI will adapt the narration.</small>
          </div>

          <div>
            <label>AI Mode</label>
            <select id="aiMode">
              <option value="narrative">Narrative (story-first)</option>
              <option value="puzzle">Puzzle (hint-first)</option>
              <option value="mystery">Mystery (cryptic)</option>
            </select>
          </div>

          <div style="margin-top:auto">
            <label>Save slots</label>
            <div class="save-slot" id="slots"></div>
          </div>
        </div>
      </div>

      <footer>
        <small>Note: This demo expects a backend proxy at <code>/api/chat</code> that forwards to the OpenAI API. See README in the code document.</small>
      </footer>
    </div>

  </div>

  <!-- Save / Name modal (hidden) -->
  <div id="modal" class="overlay" style="display:none">
    <div class="modal">
      <h3 id="modalTitle">Save Game</h3>
      <div>
        <label>First name</label>
        <input id="firstName" type="text" placeholder="First name" />
      </div>
      <div style="margin-top:8px">
        <label>Last name</label>
        <input id="lastName" type="text" placeholder="Last name" />
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button id="modalCancel">Cancel</button>
        <button id="modalSave" class="btn-primary">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Simple client state
    const timelines = ['Prehistoric', 'Ancient Rome', 'Medieval', 'Victorian', 'Near Future', 'Far Future']
    const slotsEl = document.getElementById('slots')
    const timelineEl = document.getElementById('timeline')
    const logEl = document.getElementById('log')
    const instabilityEl = document.getElementById('instability')
    const playerNameEl = document.getElementById('playerName')

    let state = {
      firstName: '',
      lastName: '',
      instability: 0,
      timeline: timelines[0],
      history: []
    }

    // populate timeline select and save slots
    timelines.forEach(t => {
      const opt = document.createElement('option')
      opt.value = t
      opt.textContent = t
      timelineEl.appendChild(opt)
    })

    function refreshSlots(){
      slotsEl.innerHTML = ''
      for(let i=1;i<=3;i++){
        const s = document.createElement('div')
        s.className = 'slot'
        const data = localStorage.getItem('chrono_slot_'+i)
        s.textContent = data ? JSON.parse(data).firstName + ' ' + JSON.parse(data).lastName : 'Empty slot '+i
        s.style.cursor = 'pointer'
        s.onclick = ()=>{
          if(data){
            loadSave(i)
          } else {
            openSaveModal(i)
          }
        }
        slotsEl.appendChild(s)
      }
    }

    refreshSlots()

    // UI wiring
    document.getElementById('btn-play').onclick = ()=>{
      document.getElementById('titleScreen').style.display='none'
      document.getElementById('gameScreen').style.display='block'
      appendLog('You step into the ChronoPort. Where do you go first?')
      updateUI()
    }
    document.getElementById('btn-send').onclick = handleSend
    document.getElementById('playerInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleSend()})
    document.getElementById('btn-save').onclick = ()=>openSaveModal()
    document.getElementById('btn-load').onclick = ()=>{ openLoadPicker() }
    document.getElementById('btn-quit').onclick = ()=>{ location.reload() }
    document.getElementById('modalCancel').onclick = ()=>closeModal()
    document.getElementById('modalSave').onclick = ()=>confirmSave()

    timelineEl.onchange = ()=>{ state.timeline = timelineEl.value }

    function appendLog(text, kind='ai'){
      const p = document.createElement('div')
      p.style.marginBottom='8px'
      p.innerHTML = (kind==='ai'?'<strong>Chronicle:</strong> ':'<strong>You:</strong> ')+escapeHtml(text)
      logEl.appendChild(p)
      logEl.scrollTop = logEl.scrollHeight
    }

    function escapeHtml(s){ return s.replace(/[&<>\"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\\':'\\\\','"':'&quot;'}[c])) }

    async function handleSend(){
      const txt = document.getElementById('playerInput').value.trim()
      if(!txt) return
      appendLog(txt, 'player')
      document.getElementById('playerInput').value=''

      // Build prompt for the AI
      const prompt = buildPrompt(txt)
      appendLog('Thinking...', 'ai')
      try{
        const aiText = await callAi(prompt)
        // replace last 'Thinking...' entry with real response
        logEl.lastChild.innerHTML = '<strong>Chronicle:</strong> '+escapeHtml(aiText)
        state.history.push({player:txt, ai:aiText, timeline:state.timeline, aiMode:document.getElementById('aiMode').value})

        // small game logic: increase instability for risky choices
        if(/destroy|split|alter|erase|kill|prevent/i.test(txt)){
          state.instability += 1
          instabilityEl.textContent = state.instability
        }

      }catch(err){
        logEl.lastChild.innerHTML = '<strong>Chronicle:</strong> Error contacting AI.'
        console.error(err)
      }

    }

    function buildPrompt(playerText){
      const mode = document.getElementById('aiMode').value
      return `You are "Chronicle", an AI narrator in a short single-player time-travel game. Player name: ${state.firstName} ${state.lastName}. Era: ${state.timeline}. Mode: ${mode}.

Rules: Keep the reply to about 2-4 sentences. If asked for a puzzle or problem include a single hint rather than the full solution. If player attempts harmful timeline changes, warn about consequences and increase instability in narration. Use vivid sensory details.

Player action: "${playerText}"

Reply:`
    }

    async function callAi(prompt){
      // Sends prompt to your server-side proxy which holds the OpenAI API key
      const res = await fetch('/api/chat', {
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({prompt})
      })
      if(!res.ok) throw new Error('API error')
      const j = await res.json()
      // server returns {reply: '...' }
      return j.reply
    }

    // Save / Load logic
    let pendingSlot = null
    function openSaveModal(slot=null){
      pendingSlot = slot || 1
      document.getElementById('modalTitle').textContent = 'Save Game'
      document.getElementById('firstName').value = state.firstName
      document.getElementById('lastName').value = state.lastName
      document.getElementById('modal').style.display='grid'
    }
    function closeModal(){ document.getElementById('modal').style.display='none' }
    function confirmSave(){
      const fn = document.getElementById('firstName').value.trim() || 'Anon'
      const ln = document.getElementById('lastName').value.trim() || 'Traveler'
      state.firstName = fn
      state.lastName = ln
      const payload = {firstName:fn,lastName:ln,instability:state.instability,timeline:state.timeline,history:state.history}
      localStorage.setItem('chrono_slot_'+pendingSlot, JSON.stringify(payload))
      appendLog(`Game saved to slot ${pendingSlot}.`,'ai')
      playerNameEl.textContent = fn + ' ' + ln
      refreshSlots()
      closeModal()
    }

    function openLoadPicker(){
      // open a little picker using prompt for simplicity
      const slot = prompt('Load which slot? (1-3)')
      const s = parseInt(slot)
      if(s>=1 && s<=3) loadSave(s)
    }

    function loadSave(i){
      const data = localStorage.getItem('chrono_slot_'+i)
      if(!data){ alert('Empty slot') ; return }
      const obj = JSON.parse(data)
      state.firstName = obj.firstName
      state.lastName = obj.lastName
      state.instability = obj.instability || 0
      state.timeline = obj.timeline || timelines[0]
      state.history = obj.history || []
      playerNameEl.textContent = state.firstName + ' ' + state.lastName
      instabilityEl.textContent = state.instability
      timelineEl.value = state.timeline
      appendLog(`Loaded save from slot ${i}. Welcome back, ${state.firstName}.`,'ai')
    }

    function updateUI(){
      playerNameEl.textContent = (state.firstName||'Traveler') + ' ' + (state.lastName||'')
      instabilityEl.textContent = state.instability
    }

    // quick autosave when leaving
    window.addEventListener('beforeunload', ()=>{
      try{
        localStorage.setItem('chrono_autosave', JSON.stringify(state))
      }catch(e){}
    })

    // try to auto-load autosave
    (function(){
      const au = localStorage.getItem('chrono_autosave')
      if(au){ state = {...state,...JSON.parse(au)}; updateUI(); }
    })()

  </script>
</body>
</html>



<!-- ======================= server.js ======================= -->

// Minimal Node/Express proxy. Save as server.js and run with node.
// IMPORTANT: set environment variable OPENAI_API_KEY to your key before starting.
// This proxy simply forwards the prompt to the Chat Completions endpoint and returns { reply: string }

/*
const express = require('express')
const fetch = require('node-fetch') // or use global fetch in Node >=18
const app = express()
app.use(express.json())

const OPENAI_KEY = process.env.OPENAI_API_KEY
if(!OPENAI_KEY){
  console.error('Set OPENAI_API_KEY in the environment before starting the server')
  process.exit(1)
}

app.post('/api/chat', async (req, res) => {
  try{
    const { prompt } = req.body
    // choose a model you have access to (gpt-4o, gpt-4, gpt-3.5-turbo, etc.)
    const model = 'gpt-4o-mini' // change to a model you have access to
    const payload = {
      model,
      messages: [{ role:'system', content:'You are "Chronicle", a helpful game narrator.' },{ role:'user', content: prompt }],
      max_tokens: 200
    }

    const r = await fetch('https://api.openai.com/v1/chat/completions', {
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':`Bearer ${OPENAI_KEY}`},
      body: JSON.stringify(payload)
    })

    if(!r.ok){
      const errtxt = await r.text()
      return res.status(500).json({error:errtxt})
    }

    const j = await r.json()
    const reply = j.choices && j.choices[0] && j.choices[0].message && j.choices[0].message.content ? j.choices[0].message.content.trim() : 'No reply.'
    res.json({reply})
  }catch(e){
    console.error(e)
    res.status(500).json({error:e.message})
  }
})

app.use(express.static('.')) // serves index.html if you place it in same folder

const PORT = process.env.PORT || 3000
app.listen(PORT, ()=>console.log('Server running on http://localhost:'+PORT))
*/



<!-- ======================= README / Quick run instructions ======================= -->

<!--
1) Save the HTML portion to index.html in a new folder. Save the server.js content to server.js in the same folder (remove the comment block markers around the code before use).

2) Install node dependencies:
   npm init -y
   npm install express node-fetch

   (If using Node 18+, you can use the built-in fetch and skip node-fetch.)

3) Set your OpenAI API key in the environment:
   On macOS / Linux:
     export OPENAI_API_KEY="sk-..."
   On Windows (PowerShell):
     $Env:OPENAI_API_KEY = "sk-..."

4) Start the server:
   node server.js

5) Open http://localhost:3000 in your browser. The front end will call /api/chat which is proxied by the server.

Security note: Never put your API key directly in client-side code. Always use a server-side proxy as provided here.

Customization: Tweak the prompt format inside index.html (buildPrompt) to change how the AI narrates. Adjust model name in server.js to one you have access to.

-->
